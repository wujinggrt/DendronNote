---
id: ucpb1eolbg023a0ftyf1m9z
title: CAN总线通信流程设计方案
desc: ''
updated: 1739694624403
created: 1739694607903
---

# CANOPEN指令解析
## COB_ID


| COB_ID                                | 范围                             | 说明                         |
| ------------------------------------- | -------------------------------- | ---------------------------- |
| **0x0000**                            |                                  | NMT设备控制报文 只有主站能发 |
| **0x0080**                            |                                  | SYNC同步报文                 |
| **0x0700+Node_ID**                    | 0x0701~0x077F                    | NMT节点报文                  |
| **0x0600+Node_ID**                    | 0x0601 ~0x067F                   | SDO命令报文                  |
| **0x0580+Node_ID**                    | 0x0581~0x05FF                    | SDO命令反馈报文              |
| **0x0200+Node_ID --- 0x0500+Node_ID** | 0x0201~0x027F --- 0x0501 ~0x057F | PDO命令报文 (第1～4组)       |
| **0x0180+Node_ID --- 0x0480+Node_ID** | 0x0181~0x01FF --- 0x0481 ~0x04FF | PDO节点状态报文 (第1～4组)   |

## 数据

### 1.NMT命令数据(COB_ID: 0x0000)

**数据组成:**
| 命令字 | 节点ID |
| ------ | ------ |
| **00** | 00     |

**命令字内容含义：**

| 命令字   | 功能用法       |
| -------- | -------------- |
| **0x01** | 启动节点       |
| **0x02** | 停止节点       |
| **0x80** | 进入预操作状态 |
| **0x81** | 重置节点       |
| **0x82** | 重置通信       |

**例:**

| COB_ID     | 数据  | 说明        |
| ---------- | ----- | ----------- |
| **0x0000** | 81 01 | 重置1号节点 |

### 2.SYNC同步报文数据(COB_ID：0x0080)
也叫做同步帧，没有数据部分。他是使用同步通信模式时的触发器，即节点执行PDO命令并上传驱动当前状态（执行这上个周期的控制器命令，上传驱动当前状态）。

### 3.NMT节点报文数据(COB_ID: 0x0700+Node_ID)
数据部分只有一个字节，含义如下：

| 数值     | 状态                                      |
| -------- | ----------------------------------------- |
| **0x00** | 初始化                                    |
| **0x01** | 断线                                      |
| **0x02** | 连接                                      |
| **0x03** | 预备                                      |
| **0x04** | 停止                                      |
| **0x05** | 可使用 (可使用PDO通信)                    |
| **0x7F** | 预使用 (可使用SDO通信，但不可使用PDO通信) |


### 4.SDO报文数据(COB_ID: 0x0600+Node_ID 和 0x0580+Node_ID)


<table>
    <tr>
        <th rowspan="2">命令字</th>
        <th colspan="2">对象索引（16位）</th>
        <th rowspan="2">子索引</th>
        <th colspan="4">数据（32位）</th>
    </tr>
    <tr>
        <th>0-7位</th>
        <th>8-15位</th>
        <th>0-7位</th>
        <th>8-15位</th>
        <th>16-23位</th>
        <th>24-33位</th>
    </tr>
    <tr>
        <td>CS</td>
        <td>IX0</td>
        <td>IX1</td>
        <td>SU</td>
        <td>D0</td>
        <td>D1</td>
        <td>D2</td>
        <td>D3</td>
    </tr>
    <tr>
        <td>00</td>
        <td>00</td>
        <td>00</td>
        <td>00</td>
        <td>00</td>
        <td>00</td>
        <td>00</td>
        <td>00</td>
    </tr>
</table>

**数据标准样式**

<table>
    <tr>
        <th>数据长度</th>
        <th>SDO 读命令</th>
        <th>SDO 写命令</th>
    </tr>
    <tr>
        <td>8位</td>
        <td>40 IX0 IX1 SU</td>
        <td><span style="color:red">2F</span> IX0 IX1 SU D0</td>
    </tr>
    <tr>
        <td>回复</td>
        <td><span style="color:red">4F</span> IX0 IX1 SU D0</td>
        <td>60 IX0 IX1 SU 00 00 00 00</td>
    </tr>
    <tr>
        <td>16位</td>
        <td>40 IX0 IX1 SU</td>
        <td><span style="color:red">2B</span> IX0 IX1 SU D0 D1</td>
    </tr>
    <tr>
        <td>回复</td>
        <td><span style="color:red">4B</span> IX0 IX1 SU D0 D1</td>
        <td>60 IX0 IX1 SU 00 00 00 00</td>
    </tr>
    <tr>
        <td>32位</td>
        <td>40 IX0 IX1 SU</td>
        <td><span style="color:red">23</span> IX0 IX1 SU D0 D1 D2 D3</td>
    </tr>
    <tr>
        <td>回复</td>
        <td><span style="color:red">43</span> IX0 IX1 SU D0 D1 D2 D3</td>
        <td>60 IX0 IX1 SU 00 00 00 00</td>
    </tr>
    <tr>
        <td>出现错误回复</td>
        <td><span style="color:red">80</span> IX0 IX1 SU D0 D1 D2 D3</td>
        <td>(数据是终止上传代码)</td>
    </tr>
</table>


**错误代码**

| 终止代码   | 描述                                                                         |
| ---------- | ---------------------------------------------------------------------------- |
| 0503 0000h | 切换位补偿                                                                   |
| 0504 0000h | SDO 协议超时                                                                 |
| 0504 0001h | 命令说明符无效                                                               |
| 0504 0002h | 块大小无效（仅适用于块模式，请参阅 DS301）                                   |
| 0504 0003h | 序列号无效（仅适用于块模式，请参阅 DS301）                                   |
| 0504 0004h | CRC 错误（仅适用于块模式，请参阅 DS301）                                     |
| 0504 0005h | 内存不足                                                                     |
| 0602 0002h | 尝试写一个只读对象                                                           |
| 0602 0000h | 对象在对象字典中不存在                                                       |
| 0604 0001h | 对象不能映射到 PDO                                                           |
| 0604 0002h | 要映射的对象的数量和长度超过 PDO 长度                                        |
| 0604 0003h | 一般参数不兼容的原因                                                         |
| 0604 0007h | 一般在设备内部不兼容                                                         |
| 0606 0000h | 由于硬件错误，访问失败                                                       |
| 0607 0010h | 数据类型不匹配，服务参数长度不匹配                                           |
| 0607 0012h | 数据类型不匹配，服务参数的长度太长                                           |
| 0607 0013h | 数据类型不匹配，服务参数的长度太短                                           |
| 0609 0011h | 字索引不存在                                                                 |
| 0609 0030h | 超出参数值范围（仅限写访问）                                                 |
| 0609 0031h | 参数值过大                                                                   |
| 0609 0032h | 参数值过小                                                                   |
| 0609 0036h | 最大值小于最小值                                                             |
| 0800 0000h | 一般错误                                                                     |
| 0800 0020h | 数据不能传输或存储到应用程序                                                 |
| 0800 0021h | 由于本地控制，数据不能传输或存储到应用程序中                                 |
| 0800 0022h | 由于当前设备状态，数据无法传输或存储到应用程序                               |
| 0800 0023h | 对象字典的动态生成失败或者不存在对象字典（发生文件和文件错误的对象字典加载） |


### 5.PDO报文数据(COB_ID: 0x02(2\~5)00+Node_ID 和 0x01(1~4)80+Node_ID)
PDO报文的数据全部都是用来传递实时数据，各个数据代表的3意义是在PDO配置时提前约定好的，我们先介绍一下PDO的配置命令组成：

<table border="1" cellspacing="0" cellpadding="5">
    <tr>
        <th rowspan="2">命令字</th>
        <th colspan="2">通道索引</th>
        <th rowspan="2">通道子索引</th>
        <th rowspan="2">参数大小（长度）</th>
        <th rowspan="2">参数子地址</th>
        <th colspan="2">配置参数</th>
    </tr>
    <tr>
        <th>0-7位</th>
        <th>8-15位</th>
        <th>0-7位</th>
        <th>8-15位</th>
    </tr>
    <tr>
        <td>CS</td>
        <td>IX0</td>
        <td>IX1</td>
        <td>SU</td>
        <td>LE</td>
        <td>ZZ</td>
        <td>SS0</td>
        <td>SS1</td>
    </tr>
    <tr>
        <td>23</td>
        <td>00</td>
        <td>00</td>
        <td>00</td>
        <td>00</td>
        <td>00</td>
        <td>00</td>
        <td>00</td>
    </tr>
</table>

## PDO参数配置
### 1.PDO通讯参数（"XXh”中“h”代表16进制数)
### (1) PDO 通讯参数（“XXh” 中 “h” 代表 16 进制数）

<table border="1" cellspacing="0" cellpadding="5">
    <tr>
        <th>索引</th>
        <th>子索引</th>
        <th>描述</th>
        <th>数据类型</th>
    </tr>
    <tr>
        <td rowspan="12">RPDO：1400h ~ 15FFh <br> TPDO：1800h ~ 19FFh</td>
        <td>00h</td>
        <td>参数条目数量</td>
        <td>Unsigned 8</td>
    </tr>
    <tr>
        <td>01h</td>
        <td>发送/接收这个 PDO 的帧 ID</td>
        <td>Unsigned 32</td>
    </tr>
    <tr>
        <td rowspan="7">02h</td>
        <td>发送类型</td>
        <td rowspan="7">Unsigned 8</td>
    </tr>
    <tr><td>00h：非循环同步</td></tr>
    <tr><td>01h：循环同步</td></tr>
    <tr><td>FCh：远程同步</td></tr>
    <tr><td>FDh：远程异步</td></tr>
    <tr><td>FEh：异步，制造商特定事件</td></tr>
    <tr><td>FFh：异步，设备子协议特定事件</td></tr>
    <tr>
        <td>03h</td>
        <td>生产率禁止上界时间（1/10ms）</td>
        <td>Unsigned 16</td>
    </tr>
    <tr>
        <td>05h</td>
        <td>事件定时器触发的时间（单位 ms）</td>
        <td>Unsigned 16</td>
    </tr>
    <tr>
        <td>06h</td>
        <td>同步起始值</td>
        <td>Unsigned 8</td>
    </tr>
</table>

<h3>示例 PDO 帧</h3>
<pre>
0x180  04 01 00 00 80
</pre>

<h3>帧解析</h3>
<table border="1" cellspacing="0" cellpadding="5">
    <tr>
        <th>字节</th>
        <th>数据</th>
        <th>解析</th>
    </tr>
    <tr>
        <td><b>ID</b></td>
        <td>0x180</td>
        <td>TPDO1（1800h）</td>
    </tr>
    <tr>
        <td>Byte 0</td>
        <td>04</td>
        <td>发送类型（同步传输）</td>
    </tr>
    <tr>
        <td>Byte 1-3</td>
        <td>01 00 00</td>
        <td>PDO 传输 ID（0x000001）</td>
    </tr>
    <tr>
        <td>Byte 4</td>
        <td>80</td>
        <td>事件触发，异步传输</td>
    </tr>
</table>

<p>该 PDO 帧表示 <b>TPDO1（1800h）</b>，使用 <b>同步传输模式</b>（04h），PDO ID 0x00 00 01，且支持 <b>异步事件触发（80h）</b>。</p>

### 2.PDO映射参数（“XXh”中“h”代表16进制数)
<table border="1" cellspacing="0" cellpadding="5">
    <tr>
        <th>索引</th>
        <th>子索引</th>
        <th>描述</th>
        <th>数据类型</th>
    </tr>
    <tr>
        <td rowspan="4">RPDO：1600h ~ 17FFh <br> TPDO：1A00h ~ 1BFFh</td>
        <td>00h</td>
        <td>参数条目数量（通道配置参数个数）</td>
        <td>Unsigned 8</td>
    </tr>
    <tr>
        <td>01h</td>
        <td>第一个参数相关参数（数据地址、子地址、长度）</td>
        <td>Unsigned 32</td>
    </tr>
    <tr>
        <td>...</td>
        <td>...</td>
        <td>...</td>
    </tr>
    <tr>
        <td>08h</td>
        <td>第八个参数相关参数（数据地址、子地址、长度）</td>
        <td>Unsigned 32</td>
    </tr>
</table>

<p><b>注：</b> 配置命令见 2.(5) PDO 报文数据，一组 PDO 最多能映射 64 位数据（4 个 Word）。</p>

**配置一个通道的协议：**

<table border="1" cellspacing="0" cellpadding="5">
    <tr>
        <th>帧 ID</th>
        <th>长度</th>
        <th>数据</th>
        <th>说明</th>
    </tr>
    <tr>
        <td colspan="4"><b>配置第一组接收 RPDO（对驱动设备是接收，是上位机发送的命令）</b></td>
    </tr>
    <tr>
        <td>601</td>
        <td>8</td>
        <td>2F 00 16 00 00 00 00 00</td>
        <td>将 RPDO 映射清空</td>
    </tr>
    <tr>
        <td>581</td>
        <td>8</td>
        <td>60 00 16 00 00 00 00 00</td>
        <td>清空命令执行成功</td>
    </tr>
    <tr>
        <td>601</td>
        <td>8</td>
        <td>23 00 16 01 10 00 CD AB</td>
        <td>配置第一个映射 ABCD_00 长度 16 位</td>
    </tr>
    <tr>
        <td>581</td>
        <td>8</td>
        <td>60 00 16 01 00 00 00 00</td>
        <td>配置 ABCD_00 成功</td>
    </tr>
    <tr>
        <td>601</td>
        <td>8</td>
        <td>23 00 16 02 20 00 GH EF</td>
        <td>配置第二个映射 EFGH_00 长度 32 位</td>
    </tr>
    <tr>
        <td>581</td>
        <td>8</td>
        <td>60 00 16 02 00 00 00 00</td>
        <td>配置 EFGH_00 成功</td>
    </tr>
    <tr>
        <td colspan="4"><b>配置第一组发送 TPDO（对驱动设备是发送，回馈给上位机的信息）</b></td>
    </tr>
    <tr>
        <td>601</td>
        <td>8</td>
        <td>2F 00 1A 00 00 00 00 00</td>
        <td>将 TPDO 映射清空</td>
    </tr>
    <tr>
        <td>581</td>
        <td>8</td>
        <td>60 00 1A 00 00 00 00 00</td>
        <td>清空命令执行成功</td>
    </tr>
    <tr>
        <td>601</td>
        <td>8</td>
        <td>23 00 1A 01 10 00 KL IJ</td>
        <td>配置第一个映射 IJKL_00 长度 16 位</td>
    </tr>
    <tr>
        <td>581</td>
        <td>8</td>
        <td>60 00 1A 01 00 00 00 00</td>
        <td>配置 IJKL_00 成功</td>
    </tr>
    <tr>
        <td>601</td>
        <td>8</td>
        <td>23 00 1A 02 10 00 OP MN</td>
        <td>配置第二个映射 MNOP_00 长度 16 位</td>
    </tr>
    <tr>
        <td>581</td>
        <td>8</td>
        <td>60 00 1A 02 00 00 00 00</td>
        <td>配置 MNOP_00 成功</td>
    </tr>
    <tr>
        <td>601</td>
        <td>8</td>
        <td>23 00 1A 03 20 00 ST QR</td>
        <td>配置第三个映射 QRST_00 长度 32 位</td>
    </tr>
    <tr>
        <td>581</td>
        <td>8</td>
        <td>60 00 1A 03 00 00 00 00</td>
        <td>配置 QRST_00 成功</td>
    </tr>
    <tr>
        <td colspan="4"><b>同步命令 & PDO 通信</b></td>
    </tr>
    <tr>
        <td>080</td>
        <td>0</td>
        <td></td>
        <td>同步命令帧</td>
    </tr>
    <tr>
        <td>201</td>
        <td>6</td>
        <td>00 00 00 00 00 00</td>
        <td>发送命令 ABCD_00 为 00 00, EFGH_00 为 00 00 00 00</td>
    </tr>
    <tr>
        <td>181</td>
        <td>8</td>
        <td>70 82 00 00 00 00 00 00</td>
        <td>从站上传 IJKL_00 为 82 70, MNOP_00 为 00 00, QRST_00 为 00 00 00 00</td>
    </tr>
</table>




#  初始化配置

## 设置PDO通道(按照顺序)
### 关闭不需要的PDO通道

#### 关闭默认PDO通道(使用SDO进行配置)
##### User_pdo_1801_01[8] = {0x23,0x01,0x18,0x01,0x81,0x02,0x00,0x80}

示例帧：ID=0x601, Data=23 01 18 01 81 02 00 80
 
**命令字**: 0x23       → SDO写请求
**对象地址**: 0x1801   → TPDO1通信参数（0x01 18小端模式）
**子索引**: 0x01       → 传输类型
**数据**: 0x8002      → 禁用TPDO1（传输类型设为无效）

防止默认PDO干扰，确保自定义映射生效

0x1401 - 0x1403 RPDO1-3通信参数
0x1801 - 0x1803 TPDO1-3通信参数


### 配置  TPDO  映射（状态反馈）
##### User_pdo_1A00_01[8] = {0x23,0x00,0x1A,0x01,0x10,0x00,0x41,0x60}

示例帧：ID=0x601, Data=23 00 1A 01 10 00 41 60

**命令字**: 0x23       → SDO写请求
**对象地址**: 0x1A00   → TPDO1映射参数
**子索引**: 0x01       → 映射条目1
**数据**: 0x60410010  → 映射状态字6041h（16位数据）

0x1A00 子索引0 → 映射条目数（如3条映射需写0x03）
每条映射格式：**[对象地址][子索引][数据长度]（小端模式）**

### 配置RPDO映射（控制指令）
##### User_pdo_1600_01[8] = {0x23,0x00,0x16,0x01,0x10,0x00,0x40,0x60}


示例帧：ID=0x601, Data=23 00 16 01 10 00 40 60

**命令字**: 0x23       → SDO写请求
**对象地址**: 0x1600   → RPDO1映射参数
**子索引**: 0x01       → 映射条目1
**数据**: 0x60400010  → 映射控制字6040h（16位数据）

0x6040（控制字）
0x6071（目标电流）
0x607A（目标位置）

### 设置心跳协议
##### {0x2B,0x17,0x10,0x00,0xC8,0x00,0x00,0x00}


示例帧：ID=0x601, Data=2B 17 10 00 C8 00 00 00

**命令字**: 0x2B       → SDO写请求（加速传输）
**对象地址**: 0x1017   → 心跳生产者时间
**子索引**: 0x00       → 主参数
**数据**: 0xC800      → 心跳间隔200ms（0xC8=200）

**作用**：主站检测节点在线状态

**响应机制**：节点定期发送心跳帧（ID=0x700 + 节点ID）


# 模式设置

### 设置工作模式（6060h）

##### {0x2F,0x60,0x60,0x00,0x01,0x00,0x00,0x00}

示例帧：ID=0x601, Data=2F 60 60 00 01 00 00 00

**命令字**: 0x2F       → SDO写请求（分段传输）
**对象地址**: 0x6060   → 模式选择
**子索引**: 0x00       → 主模式
**数据**: 0x01        → **位置模式（1=位置，3=速度，A=电流）**


### 运动参数配置



示例帧：ID=0x601 , Data=23 83 60 00 88 13 00 00

**命令字**: 0x23       → SDO写请求
**对象地址**: 0x6083   → 加速度参数
**子索引**: 0x00       → 主参数
**数据**: 0x1388      → 加速度值5000（实际50 RPM/S，需×100）


**0x6083：加速度**
**0x6084：减速度**
**0x6081：轮廓速度**




# 状态机控制



### 步骤1：准备使能（控制字=0x0006）
ID=0x601, Data=2B 40 60 00 06 00 00 00
**对象地址**: 0x6040, 数据: 0x0006

### 步骤2：使能激活（控制字=0x0007）
ID=0x601, Data=2B 40 60 00 07 00 00 00

### 步骤3：启动运动（控制字=0x000F）
ID=0x601, Data=2B 40 60 00 0F 00 00 00






# 实时控制

### 通过PDO写入目标的状态和位置

示例帧：ID=0x201, Data=0F 00 00 40 00 00 00 00

ID=**0x201**          → RPDO1的CAN ID（0x200+节点ID）
数据解析：
- **控制字**: 0x000F  → 启动
- **目标位置**: 0x4000 → 16384cnt（90°）
 
### SDO与PDO分工


| 类型 | 方向      | 作用                      | 典型ID           |
| ---- | --------- | ------------------------- | ---------------- |
| SDO  | 双向      | 配置参数、读取状态        | **0x600+节点ID** |
| TPDO | 从机→主机 | 实时状态反馈（位置/电流） | **0x180+节点ID** |
| RPDO | 主机→从机 | 实时控制指令（目标位置）  | **0x200+节点ID** |

 ### 同步传输（SYNC帧）
 
示例帧：ID=0x80, Data=空

**作用**：触发所有节点同步发送TPDO
**配置关键点**：
- **TPDO传输类型设置为1-240（同步窗口编号）**
- **RPDO可配置为同步响应模式**

###  错误处理

示例帧：ID=0x581, Data=4B 3F 60 00 01 00 00 00

**对象地址**: 0x603F   → 错误寄存器
**数据**: 0x0001      → 过压故障
**处理流程**：
**1. 读取错误代码（0x603F）**
**2. 发送控制字0x0080（故障复位）**
**3. 重新使能**



