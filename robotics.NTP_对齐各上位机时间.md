---
id: 5quv9e3bkufue2xqhhdx4fl
title: NTP_对齐各上位机时间
desc: ''
updated: 1750990385047
created: 1750988595630
---

## 问题

各上位机的时间不同步，可能导致数据不同步。对齐各传感器时延，首先要保障时间对齐。

技术选型：NTP 通常使用 ntp (传统) 和 chrony (新兴)，对比如下：

| 对比维度   | Chrony                            | NTP (ntpd)                   |
| ---------- | --------------------------------- | ---------------------------- |
| 算法       | 时间中值算法 (Temporal Median)  | 复杂滤波算法                 |
| 同步速度   | 分钟级快速收敛（尤其冷启动）⑥⑨    | 小时级收敛，慢速调整 ⑨       |
| 网络适应性 | 高延迟/间歇网络下更稳定 ①⑤        | 依赖稳定网络，延迟敏感 ④     |
| 资源消耗   | 低内存/CPU，节能设计 ⑥⑧           | 较高资源占用 ⑦⑧              |
| 配置复杂度 | 简单，自动适应环境 ③⑩             | 复杂，需手动调优 ⑦           |
| 安全性     | 支持 NTS 加密认证 ⑤⑧              | 依赖外部扩展（如 Autokey） ④ |

chrony 表现更为优秀。优势如下：

-   **同步效率与精度**
    
    -   **快速收敛**：通过 `iburst` 参数和自适应算法，首次同步仅需数分钟，而 NTP 可能需数小时69。
        
    -   **抗网络波动**：在高延迟或丢包网络（如移动网络、VPN）中仍保持微秒级精度，NTP 易受干扰15。
        
-   **低资源与节能设计**
    
    -   占用内存更少（约 1/3 的 NTP 内存），适合虚拟机、容器或嵌入式设备68。
        
    -   按需唤醒 CPU，减少持续资源消耗58。
        
-   **灵活性与容错能力**
    
    -   **无网络同步**：可依赖本地时钟计算漂移率，离线维持时间精度310。
        
    -   **时钟跳变处理**：`makestep` 参数允许渐进式调整时间，避免服务中断（如数据库事务冲突）；NTP 的 `ntpdate` 会强制跳跃时间引发故障510。
        
-   **安全增强**  
    原生支持 **NTS（Network Time Security）**，提供端到端加密，抵御中间人攻击；NTP 需额外配置 Autokey（已曝安全缺陷）45。

Chrony 在精度、效率、安全性上全面超越传统 NTP，尤其适合现代分布式架构。

## 配置 chrony

```bash
sudo apt install -y chrony
```

修改服务器的配置 /etc/chrony.conf 文件，设置标准时间源，即 NTP 参考的时间源：

```
pool cn.pool.ntp.org iburst # 除了 pool 外，还有 server、peer，具体可参考官方文档

```

查看系统时间命令：

```bash
date +"%s" # 秒
date +"%N" # 纳秒
```

## 使用 Docker

服务监管更统一。

## Ref and Tag

https://chrony.tuxfamily.org/

chrony 踩坑笔记 - 小李刑的文章 - 知乎
https://zhuanlan.zhihu.com/p/582666179